<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1 , user-scalable=no">
    <title>海豚战报</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../css/flipclock.css"/>
    <link rel="stylesheet" href="../css/animate.css"/>
    <link rel="stylesheet" href="../css/bootstrap-ht.css"/>
</head>
<body>
<!--导航-->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!--小屏幕导航按钮和logo-->
        <div class="navbar-header">
            <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="index.html" class="navbar-brand " id="logo"></a>
        </div>
        <!--小屏幕导航按钮和logo-->
        <!--导航-->
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#home">首页</a></li>
                <li><a href="#order_distribute">订单分布</a></li>
                <li><a href="#pv">访问量</a></li>
                <li><a href="#category">类目</a></li>
                <li><a href="#single_product_ranking">单品排名</a></li>
                <li><a href="#refresh" id="refresh"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a></li>
            </ul>
        </div>
        <!--导航-->
    </div>
</nav>
<!--导航-->

<!--home-->
<section id="home">
    <div class="lvjing">
        <div class="container">
            <div class="row wow fadeInUp" data-wow-duration="1s" data-wow-delay="1s" style="text-align: center">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="clock wow jello "   data-wow-duration="1s" data-wow-delay="2s" ></div>
                    <h1>今日成交订单数: <span id="today_order_total_num">0</span></h1>
                    <h1>今日成交额: ¥ <span id="today_order_total_price">0.00</span></h1>
                </div>
                <div class="col-md-1"></div>
            </div>
        </div>
    </div>
</section>
<!--home-->

<!--order_distribute-->
<section id="order_distribute">
    <div class="container">
        <div class="row wow fadeInUp" data-wow-duration="0.5s">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div id="order_distribute_chart"  style="width: 100%;height:500px;"></div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </div>
</section>
<!--order_distribute-->

<!--pv-->
<section id="pv">
    <div class="container">
        <div class="row wow fadeInUp" data-wow-duration="0.5s">
            <div class="col-md-6 wow fadeInLeft">
                <div id="pv_chart_1"  style="width: 100%;height: 300px;"></div>
            </div>
            <div class="col-md-6 wow fadeInRight">
                <div id="pv_chart_2"  style="width: 100%;height: 300px;"></div>
            </div>
        </div>
    </div>
</section>
<!--pv-->

<!--category-->
<section id="category">
    <div class="container">
        <div class="row wow fadeInUp" data-wow-duration="0.5s">
            <div class="col-md-3"></div>
            <div class="col-md-6 wow bounceIn">
                <div id="category_chart"  style="width: 100%;height: 400px;"></div>
            </div>
            <div class="col-md-3"></div>
        </div>
    </div>
</section>
<!--category-->

<!--footer-->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <p>
                    Copyright&nbsp;©&nbsp;2018&nbsp;&nbsp;海豚跨境科技（香港）有限公司&nbsp;&nbsp;
                </p>
            </div>
        </div>
    </div>
</footer>
<!--footer-->


</body>
<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/jquery.singlePageNav.min.js"></script>
<script src="../js/wow.min.js"></script>
<script src="../js/accounting.min.js"></script>
<script src="../js/flipclock.min.js"></script>
<script src="../js/jquery.countup.min.js"></script>
<script src="../js/jquery.waypoints.min.js"></script>

<script src="../js/echarts.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
<script>
    $(function(){
        /*导航跳转效果插件*/
        $('.nav').singlePageNav({
            offset:70
        });
        /*小屏幕导航点击关闭菜单*/
        $('.navbar-collapse a').click(function(){
            $('.navbar-collapse').collapse('hide');
        });
        new WOW().init();

        //初始化时间
        var date = new Date();
        var clock = $('.clock').FlipClock(date, {
            clockFace: 'TwentyFourHourClock'
        });
        var init_chart = function () {
            var pv_chart_1 = echarts.init(document.getElementById('pv_chart_1'));
            var pv_chart_2 = echarts.init(document.getElementById('pv_chart_2'));
            var category_chart = echarts.init(document.getElementById('category_chart'));
            var order_distribute_chart = echarts.init(document.getElementById('order_distribute_chart'));
            $.ajax({
                type :"post",
                url : "http://local.haitunerp.com/open/chart",
                dataType : "jsonp",
                jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(默认为:callback)
                async:false,
                success : function(json){
                    var chart_data = json;
                    //初始化数量
                    var today_order_total_price = accounting.formatMoney(chart_data.order_total,'');
                    var today_order_total_num = chart_data.order_num;
                    $("#today_order_total_price").html(today_order_total_price);
                    $("#today_order_total_num").html(today_order_total_num);
                    $("#today_order_total_price,#today_order_total_num").countUp({
                        delay: 10,
                        time: 2000
                    });
                    //初始化图表
                    var order_distribute_chart_option = {
                        backgroundColor: '#fff',
                        title: {
                            text: '订单区域分布图',
                            subtext: '海豚供应链(单位:件)',
                            sublink: 'http://www.haitun.hk',
                            left: 'center',
                            textStyle: {
                                color: '#404a59',
                                fontSize:'30'
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function (params) {
                                return params.name + ' : ' + params.value[2];
                            }
                        },
                        visualMap: {
                            min: parseInt(chart_data.city_min_num),
                            max: parseInt(chart_data.city_max_num),
                            calculable: true,
                            inRange: {
                                color: ['#50a3ba', '#eac736', '#d94e5d']
                            },
                            textStyle: {
                                color: '#404a59'
                            }
                        },
                        geo: {
                            map: 'china',
                            label: {
                                emphasis: {
                                    show: true
                                }
                            },
                            itemStyle: {
                                //区块颜色
                                normal: {
                                    areaColor: '#323c48',
                                    borderColor: '#111'
                                },
                                //鼠标悬浮去区块地图的颜色
                                emphasis: {
                                    areaColor: '#2a333d'
                                }
                            },
                            zoom:1.25
                        },
                        series : [
                            {
                                type: 'scatter',
                                coordinateSystem: 'geo',
                                data: chart_data.map_data,
                                symbolSize: function (val) {
                                    return val[2] / 15;
                                },
                                label: {
                                    normal: {
                                        formatter: '{b}',
                                        position: 'right',
                                        show: false
                                    },
                                    emphasis: {
                                        show: true
                                    }
                                },
                                itemStyle: {
                                    normal: {
                                        color: '#ddb926'
                                    }
                                }
                            }
                        ]
                    };
                    // 使用刚指定的配置项和数据显示图表。
                    order_distribute_chart.setOption(order_distribute_chart_option);

                    var axis_label = chart_data.baidu_tj.xAxis_name;


                    // 指定图表的配置项和数据
                    var option_pv = {
                        title: {
                            text: '网站PV'
                        },
                        tooltip: {
                            trigger: 'axis',
                            formatter: function (params) {
                                var html = '';
                                $.each(params,function (index,value) {
                                    if(index==0){
                                        html+=axis_label[value.dataIndex]+'<br>';
                                    }
                                    html+= value.marker +value.seriesName +':'+value.data+'<br>';
                                })
                                console.log(html);
                                return html;
                            }
                        },
                        legend: {
                            data:['今日','昨日']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data:chart_data.baidu_tj.xAxis_key
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name:'今日',
                                type:'line',
                                data:chart_data.baidu_tj.today_info.pv
                            },
                            {
                                name:'昨日',
                                type:'line',
                                data:chart_data.baidu_tj.yesterday_info.pv
                            },
                        ]
                    };
                    pv_chart_1.setOption(option_pv);
                    var option_uv = {
                        title: {
                            text: '网站UV'
                        },
                        tooltip: {
                            trigger: 'axis',
                        },
                        legend: {
                            data:['今日','昨日']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data:chart_data.baidu_tj.xAxis_key
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name:'今日',
                                type:'line',
                                data:chart_data.baidu_tj.today_info.uv
                            },
                            {
                                name:'昨日',
                                type:'line',
                                data:chart_data.baidu_tj.yesterday_info.uv
                            },
                        ]
                    };
                    pv_chart_2.setOption(option_uv);
                    var category_chart_option = {
                        title: {
                            text: '类目(单位元)',
                            itemStyle: {
                                normal: {
                                    color: '#404a59'
                                }
                            }
                        },
                        tooltip: {},
                        xAxis: {
                            data: chart_data.category.name
                        },
                        yAxis: {},
                        series: [{
                            name: '销量',
                            type: 'bar',
                            data: chart_data.category.order_total,
                            itemStyle: {
                                normal: {
                                    color: '#404a59'
                                }
                            }
                        }]
                    };
                    category_chart.setOption(category_chart_option);
                },
                error:function(){
                    alert('接口异常');
                }
            });

        }



        $(window).on('load',function () {
            init_chart();
        })


        $("#refresh").on('click',function () {
            init_chart();
        })


    })
</script>
</html>